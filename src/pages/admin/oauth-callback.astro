---
// Išjungiame Astro JS optimizacijas
---

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authenticating...</title>
    <script is:inline>
      // Funkcija, kuri išparsinina URL parametrus
      function getParams() {
        const search = window.location.search.substring(1);
        return search.split('&').reduce((result, item) => {
          const parts = item.split('=');
          result[parts[0]] = decodeURIComponent(parts[1]);
          return result;
        }, {});
      }
      
      // Gauti parametrus iš URL
      const params = getParams();
      const code = params.code || '';
      const provider = params.provider || 'github';
      const state = params.state || '';
      
      // Siųsti autentifikacijos duomenis tėviniam langui
      if (window.opener) {
        // Format šiek tiek skiriasi nuo ankstesnio
        window.opener.postMessage(
          {
            type: 'auth',
            payload: {
              provider,
              code,
              state
            }
          },
          window.location.origin
        );
        window.close();
      } else {
        console.log('No opener found - redirecting to admin');
        window.location.replace('/admin/');
      }
    </script>
  </head>
  <body>
    <h1>Authenticating with GitHub, please wait...</h1>
    <p>This window should close automatically. If it doesn't, you can close it manually and return to the admin panel.</p>
  </body>
</html> 